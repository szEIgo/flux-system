---
apiVersion: v1
kind: ConfigMap
metadata:
  name: coredns
  namespace: kube-system
  labels:
    k8s-app: kube-dns
data:
  # CoreDNS configuration managed by Flux
  # Default mirrors upstream Kubernetes CoreDNS with safe forwarding.
  # Customize by uncommenting the stub-domain example below.
  Corefile: |
    .:53 {
        errors
        health
        ready
        kubernetes cluster.local in-addr.arpa ip6.arpa {
          pods insecure
          fallthrough in-addr.arpa ip6.arpa
          ttl 30
        }
        prometheus :9153
        # Use node resolv.conf for upstreams (default behavior)
        forward . /etc/resolv.conf
        cache 30
        loop
        reload
        loadbalance
    }

    home.arpa:53 {
         errors
         log
         forward . 192.168.2.1
         cache 30
    }